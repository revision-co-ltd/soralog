# 今すぐ始めるアクションリスト

**最終更新**: 2025年11月13日

---

## 🎯 現在地と次のゴール

**現状**: プロトタイプUI完成（移動端優化済み）  
**次のゴール**: 様式1〜3に対応した完全システム

---

## 📋 即座に実行可能なタスク（優先順位順）

### ✅ Task 1: 型定義ファイルの作成（20分）

**なぜ必要**: バックエンドAPIと連携するための型定義を先に作成

**実行コマンド**:
```bash
# 1. types ディレクトリを作成
mkdir -p src/types

# 2. ファイルを作成
touch src/types/index.ts
```

**コピペ可能なコード**: `既存ページ改造計画.md` の Phase A-1 セクションから、完全な型定義をコピーして `src/types/index.ts` に貼り付け

**完了条件**:
- [ ] `src/types/index.ts` が存在
- [ ] `FlightLog`, `DailyInspection`, `MaintenanceRecord` 等の型が定義されている
- [ ] TypeScript のエラーがない

---

### ✅ Task 2: API サービス層の作成（30分）

**なぜ必要**: フロントエンドとバックエンドを接続するための統一されたAPI呼び出し関数

**実行コマンド**:
```bash
# 1. services ディレクトリを作成
mkdir -p src/services

# 2. ファイルを作成
touch src/services/api.service.ts

# 3. 環境変数ファイルを作成
touch .env.local
```

**`.env.local` の内容**:
```env
VITE_API_BASE_URL=http://localhost:3000/api
```

**コピペ可能なコード**: `既存ページ改造計画.md` の Phase A-2 セクションから、完全なAPIサービスコードをコピーして `src/services/api.service.ts` に貼り付け

**完了条件**:
- [ ] `src/services/api.service.ts` が存在
- [ ] `.env.local` に `VITE_API_BASE_URL` が設定されている
- [ ] `flightLogApi`, `dailyInspectionApi`, `maintenanceRecordApi` 等が export されている

---

### ✅ Task 3: FlightLogForm の拡張開始（2時間）

**なぜ必要**: 現在のフォームは簡易版で、様式1の全項目に対応していない

**段階的なアプローチ**（一度に全部やらなくてOK）:

#### ステップ 3-1: 新しいフィールドを formData に追加（15分）
```typescript
const [formData, setFormData] = useState({
  // 既存フィールドはそのまま
  date: new Date(),
  droneModel: '',
  pilot: '',
  location: '',
  // ... 既存のフィールド ...
  
  // 🆕 新規追加フィールド
  operatorId: '',  // 操縦者ID
  outline: '',  // 飛行経路概要
  isTokuteiFlight: false,  // 特定飛行フラグ
  flightPlanNotified: false,  // 飛行計画の通報
  takeoffLocationId: '',  // 離陸場所
  takeoffTime: '',  // 離陸時刻
  landingLocationId: '',  // 着陸場所
  landingTime: '',  // 着陸時刻
  safetyImpactNote: '',  // 安全に影響事項
  faultDate: null,  // 不具合発生日
  faultDetail: '',  // 不具合事項
  fixDate: null,  // 処置実施日
  fixDetail: '',  // 処置内容
  confirmerId: '',  // 確認者ID
});
```

#### ステップ 3-2: 特定飛行チェックボックスを追加（10分）
```tsx
<div className="flex items-center gap-3">
  <Checkbox
    id="isTokuteiFlight"
    checked={formData.isTokuteiFlight}
    onCheckedChange={(checked) => 
      setFormData(prev => ({ ...prev, isTokuteiFlight: checked as boolean }))
    }
  />
  <Label htmlFor="isTokuteiFlight">特定飛行（カテゴリーⅡ・Ⅲ）</Label>
</div>
```

#### ステップ 3-3: 離陸・着陸時刻の入力フィールドを追加（15分）
```tsx
{/* 離陸時刻 */}
<div className="space-y-3 md:space-y-2">
  <Label>離陸時刻 *</Label>
  <Input
    type="time"
    value={formData.takeoffTime}
    onChange={(e) => setFormData(prev => ({ ...prev, takeoffTime: e.target.value }))}
  />
</div>

{/* 着陸時刻 */}
<div className="space-y-3 md:space-y-2">
  <Label>着陸時刻 *</Label>
  <Input
    type="time"
    value={formData.landingTime}
    onChange={(e) => setFormData(prev => ({ ...prev, landingTime: e.target.value }))}
  />
</div>
```

#### ステップ 3-4: 飛行時間の自動計算（20分）
```tsx
// useEffect で自動計算
useEffect(() => {
  if (formData.takeoffTime && formData.landingTime) {
    const takeoff = new Date(`2000-01-01T${formData.takeoffTime}`);
    const landing = new Date(`2000-01-01T${formData.landingTime}`);
    const diffMs = landing.getTime() - takeoff.getTime();
    const diffMinutes = Math.round(diffMs / 60000);
    
    if (diffMinutes > 0) {
      setFormData(prev => ({ ...prev, flightTimeMinutes: diffMinutes }));
    }
  }
}, [formData.takeoffTime, formData.landingTime]);

// 表示部分
{formData.takeoffTime && formData.landingTime && (
  <div className="p-4 bg-blue-50 border border-blue-200 rounded-xl">
    <p className="text-sm text-blue-600 font-medium">飛行時間（自動計算）</p>
    <p className="text-lg text-blue-800 font-bold">
      {formData.flightTimeMinutes}分 ({Math.floor(formData.flightTimeMinutes / 60)}時間{formData.flightTimeMinutes % 60}分)
    </p>
  </div>
)}
```

#### ステップ 3-5: 不具合情報セクションの追加（30分）
```tsx
<div className="p-4 bg-amber-50 border border-amber-200 rounded-xl space-y-4">
  <h4 className="font-medium text-amber-900">不具合が発生した場合のみ記入</h4>

  <div className="space-y-3">
    <Label>不具合発生日</Label>
    <DatePicker
      value={formData.faultDate}
      onChange={(date) => setFormData(prev => ({ ...prev, faultDate: date }))}
    />
  </div>

  <div className="space-y-3">
    <Label>不具合事項</Label>
    <Textarea
      value={formData.faultDetail}
      onChange={(e) => setFormData(prev => ({ ...prev, faultDetail: e.target.value }))}
      placeholder="不具合の内容を詳しく記載"
    />
  </div>

  {/* 処置実施日・処置内容・確認者も同様に追加 */}
</div>
```

**完了条件**:
- [ ] 特定飛行チェックボックスが動作
- [ ] 離陸・着陸時刻の入力が可能
- [ ] 飛行時間が自動計算される
- [ ] 不具合情報の入力欄が表示される

---

### ✅ Task 4: DailyInspectionForm の作成（3時間）

**新規ファイル作成**:
```bash
touch src/components/DailyInspectionForm.tsx
```

**基本構造**（スターターテンプレート）:
```tsx
import React, { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from './ui/card';
import { Button } from './ui/button';
import { Label } from './ui/label';
import { Checkbox } from './ui/checkbox';
import { Textarea } from './ui/textarea';
import { DatePicker } from './ui/date-picker';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select';

export function DailyInspectionForm({ onSubmit, drones, locations, users }) {
  const [formData, setFormData] = useState({
    droneId: '',
    inspectionType: 'pre-flight',  // or 'post-flight'
    executionDate: new Date(),
    executionPlaceId: '',
    executorId: '',
    
    // 13項目の点検結果
    resultAirframe: '未選択',
    noteAirframe: '',
    resultPropeller: '未選択',
    notePropeller: '',
    // ... 残り11項目も同様 ...
    
    specialNote: '',
  });

  const inspectionItems = [
    { key: 'airframe', label: '機体全般' },
    { key: 'propeller', label: 'プロペラ' },
    { key: 'frame', label: 'フレーム' },
    { key: 'communication', label: '通信系統' },
    { key: 'propulsion', label: '推進系統' },
    { key: 'power', label: '電源系統' },
    { key: 'control', label: '自動制御系統' },
    { key: 'controller', label: '操縦装置' },
    { key: 'battery', label: 'バッテリー・燃料' },
    { key: 'remoteId', label: 'リモートID機能' },
    { key: 'lights', label: '灯火' },
    { key: 'camera', label: 'カメラ' },
  ];

  const setAllNormal = () => {
    const updates = {};
    inspectionItems.forEach(item => {
      updates[`result${item.key.charAt(0).toUpperCase() + item.key.slice(1)}`] = '正常';
    });
    setFormData(prev => ({ ...prev, ...updates }));
  };

  return (
    <Card>
      <CardHeader>
        <CardTitle>日常点検記録（様式2）</CardTitle>
      </CardHeader>
      <CardContent className="space-y-6">
        {/* 基本情報 */}
        <div className="space-y-4">
          <Label>点検種別</Label>
          <Select value={formData.inspectionType} onValueChange={(value) => setFormData(prev => ({ ...prev, inspectionType: value }))}>
            <SelectTrigger>
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="pre-flight">飛行前点検</SelectItem>
              <SelectItem value="post-flight">飛行後点検</SelectItem>
            </SelectContent>
          </Select>
        </div>

        {/* 一括正常ボタン */}
        <Button onClick={setAllNormal} variant="outline" className="w-full">
          ✅ 全項目を「正常」に設定
        </Button>

        {/* 点検項目リスト */}
        <div className="space-y-4">
          {inspectionItems.map(item => (
            <div key={item.key} className="p-4 border rounded-lg space-y-3">
              <h4 className="font-medium">{item.label}</h4>
              <div className="flex gap-4">
                <label className="flex items-center gap-2">
                  <input
                    type="radio"
                    name={`result${item.key}`}
                    value="正常"
                    checked={formData[`result${item.key.charAt(0).toUpperCase() + item.key.slice(1)}`] === '正常'}
                    onChange={(e) => setFormData(prev => ({ ...prev, [`result${item.key.charAt(0).toUpperCase() + item.key.slice(1)}`]: e.target.value }))}
                  />
                  正常
                </label>
                <label className="flex items-center gap-2">
                  <input
                    type="radio"
                    name={`result${item.key}`}
                    value="異常"
                    checked={formData[`result${item.key.charAt(0).toUpperCase() + item.key.slice(1)}`] === '異常'}
                    onChange={(e) => setFormData(prev => ({ ...prev, [`result${item.key.charAt(0).toUpperCase() + item.key.slice(1)}`]: e.target.value }))}
                  />
                  異常
                </label>
              </div>
              <Textarea
                placeholder="備考（任意）"
                value={formData[`note${item.key.charAt(0).toUpperCase() + item.key.slice(1)}`]}
                onChange={(e) => setFormData(prev => ({ ...prev, [`note${item.key.charAt(0).toUpperCase() + item.key.slice(1)}`]: e.target.value }))}
                rows={2}
              />
            </div>
          ))}
        </div>

        <Button onClick={() => onSubmit(formData)} className="w-full" size="lg">
          点検記録を保存
        </Button>
      </CardContent>
    </Card>
  );
}
```

**完了条件**:
- [ ] `DailyInspectionForm.tsx` が作成されている
- [ ] 13項目の点検チェックリストが表示される
- [ ] 「一括正常」ボタンが動作する
- [ ] 各項目に備考を入力できる

---

### ✅ Task 5: App.tsx のナビゲーション更新（30分）

**現在の activeTab を拡張**:

```typescript
// App.tsx
type Tab = 
  | 'dashboard' 
  | 'flight-log'      // 様式1
  | 'daily-inspection' // 様式2
  | 'maintenance'     // 様式3
  | 'drones' 
  | 'operators' 
  | 'export';

const [activeTab, setActiveTab] = useState<Tab>('dashboard');

// ナビゲーションボタン
<div className="grid grid-cols-2 gap-3">
  <button onClick={() => setActiveTab('flight-log')} className="...">
    📋 飛行記録
  </button>
  <button onClick={() => setActiveTab('daily-inspection')} className="...">
    ✅ 日常点検
  </button>
  <button onClick={() => setActiveTab('maintenance')} className="...">
    🔧 点検整備
  </button>
  <button onClick={() => setActiveTab('export')} className="...">
    📤 エクスポート
  </button>
</div>

// コンテンツの切り替え
{activeTab === 'flight-log' && <FlightLogForm ... />}
{activeTab === 'daily-inspection' && <DailyInspectionForm ... />}
{activeTab === 'maintenance' && <MaintenanceRecordForm ... />}
```

**完了条件**:
- [ ] 様式1・2・3への切り替えタブが追加されている
- [ ] 各タブをクリックすると対応するフォームが表示される

---

## 🎯 今週の目標

### Week 1 完了条件（MVP準備）
- [x] ✅ Task 1: 型定義作成
- [x] ✅ Task 2: APIサービス層作成
- [x] ✅ Task 3: FlightLogForm拡張（少なくとも特定飛行フラグと時刻入力）
- [ ] ⏳ Task 4: DailyInspectionForm作成（基本構造のみでOK）
- [ ] ⏳ Task 5: App.tsx更新

---

## 📊 進捗トラッキング

毎日このチェックリストを更新して、進捗を可視化しましょう：

```
Day 1: [ ] Task 1, [ ] Task 2
Day 2: [ ] Task 3 (ステップ 3-1〜3-3)
Day 3: [ ] Task 3 (ステップ 3-4〜3-5)
Day 4: [ ] Task 4 (基本構造)
Day 5: [ ] Task 4 (完成) + Task 5
```

---

## 💡 Tips

### コピペの順番
1. まず型定義 (`src/types/index.ts`)
2. 次にAPIサービス (`src/services/api.service.ts`)
3. それから既存フォームの拡張
4. 最後に新規フォームの作成

### 動作確認の方法
```bash
# TypeScript エラーチェック
npm run build

# 開発サーバー起動
npm run dev

# ブラウザで http://localhost:5173 を開く
```

### トラブル時の対処
- TypeScript エラー → `src/types/index.ts` の型定義を確認
- Import エラー → ファイルパスを確認
- UI が崩れる → Tailwind CSS のクラス名を確認

---

## 🚀 次のステップ

このアクションリストを完了したら：
1. **バックエンド開発開始**: `docs/クイックスタートガイド.md` に従ってPostgreSQL + Prismaをセットアップ
2. **API接続テスト**: フロントエンドとバックエンドを接続
3. **完全版への移行**: 残りの機能（Excel/PDF出力、組織管理等）を追加

---

**Let's start coding! 🎉**

