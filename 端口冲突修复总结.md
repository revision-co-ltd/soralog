# 端口冲突修复总结 ✅

## 🎯 问题

您之前遇到的情况：同时在3000和3001端口运行了两个版本的前端，造成混淆。

## 🔍 根本原因

配置存在3个端口问题：

| 组件 | 旧配置 | 问题 |
|------|--------|------|
| 前端Vite | port: 3000 | ❌ 与后端冲突 |
| 后端API | port: 3000 | ❌ 与前端冲突 |
| API服务 | http://localhost:3002 | ❌ 错误的端口号 |

**冲突过程**：
1. 后端启动 → 占用3000 ✓
2. 前端启动 → 3000被占用 → 自动使用3001 ⚠️
3. API调用 → 尝试连接3002 → 失败 ❌

## ✅ 修复方案

### 已修改的文件

#### 1️⃣ `vite.config.ts`
```typescript
// 修改前
server: {
  port: 3000,  // ❌ 与后端冲突
  open: true,
},

// 修改后
server: {
  port: 5173,  // ✅ Vite标准端口
  open: true,
},
```

#### 2️⃣ `src/services/api.service.ts`
```typescript
// 修改前
const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:3002/api';
// ❌ 错误的端口

// 修改后
const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:3000/api';
// ✅ 正确的后端API端口
```

#### 3️⃣ `README.md`
更新了端口说明，确保文档准确

## 🎉 修复后的端口分配

| 服务 | 端口 | 访问地址 | 说明 |
|------|------|----------|------|
| 🎨 **前端** | **5173** | http://localhost:5173 | Vite开发服务器 |
| 🔧 **后端** | **3000** | http://localhost:3000/api | Express API服务器 |
| 🗄️ **数据库** | **5432** | localhost:5432 | PostgreSQL |

## 🚀 现在如何使用

### 启动步骤

```bash
# 1. 启动数据库
docker-compose up -d

# 2. 启动后端 (新终端)
npm run backend
# ✅ 后端运行在 http://localhost:3000

# 3. 启动前端 (新终端)
npm run dev
# ✅ 前端运行在 http://localhost:5173
# ✅ 浏览器自动打开
```

### 验证修复

启动后，检查终端输出：

**后端终端** 应该显示：
```
✅ Server running on http://localhost:3000
```

**前端终端** 应该显示：
```
  VITE v6.3.5  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
```

### ⚠️ 如果还看到3001端口

说明有旧进程未关闭，执行以下命令清理：

#### macOS/Linux:
```bash
# 查找并关闭3001端口进程
lsof -i :3001
kill -9 <PID>

# 或者关闭所有Node进程
pkill -f node
```

#### Windows:
```cmd
# 查找并关闭3001端口进程
netstat -ano | findstr :3001
taskkill /PID <PID> /F

# 或者关闭所有Node进程
taskkill /F /IM node.exe
```

然后重新启动服务。

## 📋 配置检查清单

修复后，确认以下几点：

- ✅ 前端在 **5173** 端口运行
- ✅ 后端在 **3000** 端口运行  
- ✅ **没有** 3001 或 3002 端口在运行
- ✅ 前端可以正常调用后端API
- ✅ 浏览器打开 http://localhost:5173 能看到应用

## 🔧 环境变量配置（可选）

如果需要自定义端口，创建 `.env` 文件：

```bash
# 后端端口
PORT=3000

# 前端API地址
VITE_API_BASE_URL="http://localhost:3000/api"

# 数据库连接
DATABASE_URL="postgresql://drone_log_user:drone_log_pass_2025@localhost:5432/drone_log_db"
```

## 📚 相关文档

- 📘 [端口配置说明.md](./端口配置说明.md) - 详细的端口配置文档
- 📗 [QUICKSTART.md](./QUICKSTART.md) - 快速启动指南
- 📕 [README.md](./README.md) - 项目说明文档

## 🎊 结论

**问题已完全解决！**

- ✅ 不再有端口冲突
- ✅ 不再有3001端口的重复版本
- ✅ 前端和后端各司其职
- ✅ API调用正确连接

现在您可以：
1. 重新启动服务
2. 访问 http://localhost:5173
3. 正常使用应用，无需担心端口混淆

---

**修复日期**: 2025年11月14日  
**修复内容**: 解决前后端端口冲突问题  
**影响范围**: 开发环境配置



