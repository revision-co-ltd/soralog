# ✅ 部署检查清单

在部署应用之前，请确保完成以下所有步骤。

## 📋 部署前准备

### 1. 代码准备
- [ ] 所有代码已提交到Git
- [ ] 清理了不必要的console.log和调试代码
- [ ] 运行了本地测试，确保功能正常
- [ ] 检查了所有依赖是否正确安装

### 2. 环境变量准备
- [ ] 准备好数据库URL（DATABASE_URL）
- [ ] 生成了强JWT密钥（JWT_SECRET）
- [ ] 确定了CORS允许的域名
- [ ] 准备了前端API地址（VITE_API_URL）

### 3. 数据库准备
- [ ] 已创建云数据库实例
- [ ] 已测试数据库连接
- [ ] 已运行数据库迁移（prisma migrate deploy）
- [ ] 已填充初始数据（prisma db seed）

---

## 🚀 部署步骤检查

### 方案A：Vercel（仅前端）+ Railway（后端）

#### Vercel前端部署
- [ ] 已将代码推送到GitHub
- [ ] 已在Vercel导入项目
- [ ] 已配置构建命令：`npm run build`
- [ ] 已配置输出目录：`build`
- [ ] 已配置环境变量：`VITE_API_URL`
- [ ] 首次部署成功
- [ ] 可以访问前端页面

#### Railway后端部署
- [ ] 已在Railway创建项目
- [ ] 已连接GitHub仓库
- [ ] 已配置环境变量：
  - [ ] DATABASE_URL
  - [ ] JWT_SECRET
  - [ ] PORT（可选，Railway自动分配）
  - [ ] CORS_ORIGIN
- [ ] 已配置启动命令：`npm run backend`
- [ ] 首次部署成功
- [ ] 可以访问健康检查端点：`/api/health`

### 方案B：全Vercel部署（需重构后端）

- [ ] 已创建 `api/` 文件夹
- [ ] 已将Express路由转换为Serverless函数
- [ ] 已配置 `vercel.json`
- [ ] 已配置环境变量：
  - [ ] DATABASE_URL
  - [ ] JWT_SECRET
- [ ] 首次部署成功
- [ ] 前后端都可以访问

---

## 🔍 部署后测试

### 1. 基础功能测试
- [ ] 前端页面可以正常访问
- [ ] 后端健康检查接口正常：`GET /api/health`
- [ ] 用户可以登录
- [ ] 用户可以注册新账号

### 2. 核心功能测试
- [ ] 创建飞行记录
- [ ] 查看飞行记录列表
- [ ] 编辑飞行记录
- [ ] 删除飞行记录
- [ ] 创建日常点检记录
- [ ] 创建维护记录
- [ ] 管理无人机
- [ ] 管理飞行员
- [ ] 管理飞行地点

### 3. 导出功能测试
- [ ] 导出CSV文件
- [ ] 导出Excel文件
- [ ] 导出PDF文件

### 4. 离线功能测试（如果适用）
- [ ] 离线时可以创建记录
- [ ] 联网后自动同步
- [ ] 同步状态正确显示

### 5. 性能测试
- [ ] 页面加载时间 < 3秒
- [ ] API响应时间 < 500ms
- [ ] 图片加载正常
- [ ] 无JavaScript错误

### 6. 安全性测试
- [ ] HTTPS正常工作
- [ ] 未登录用户无法访问受保护的API
- [ ] CORS配置正确
- [ ] JWT认证正常工作
- [ ] 敏感信息没有暴露在前端

---

## 🐛 常见问题检查

### 问题检查清单
- [ ] 数据库连接正常
- [ ] 环境变量正确配置
- [ ] Prisma Client已生成
- [ ] 数据库迁移已执行
- [ ] CORS配置正确
- [ ] API端点地址正确
- [ ] JWT密钥一致
- [ ] 时区设置正确
- [ ] 文件上传功能正常（如果有）
- [ ] 邮件发送功能正常（如果有）

---

## 📊 监控设置

### 应用监控
- [ ] 已设置错误追踪（Sentry等）
- [ ] 已启用性能监控
- [ ] 已配置日志收集
- [ ] 已设置告警通知

### 数据库监控
- [ ] 已启用数据库连接池监控
- [ ] 已设置慢查询日志
- [ ] 已配置备份策略
- [ ] 已设置存储空间告警

---

## 🔒 安全检查

### 代码安全
- [ ] 没有硬编码的密钥或密码
- [ ] 所有敏感信息都使用环境变量
- [ ] 依赖包没有已知的安全漏洞
- [ ] 已启用HTTPS
- [ ] 已配置CSP（内容安全策略）

### 数据库安全
- [ ] 数据库使用SSL连接
- [ ] 数据库访问受IP限制
- [ ] 数据库密码足够强
- [ ] 已设置定期备份

### API安全
- [ ] 已实施速率限制
- [ ] 已验证所有输入
- [ ] 已实施SQL注入防护
- [ ] 已实施XSS防护
- [ ] 已实施CSRF防护

---

## 📝 文档更新

- [ ] 更新README.md中的部署URL
- [ ] 更新API文档
- [ ] 记录环境变量配置
- [ ] 记录部署步骤和遇到的问题
- [ ] 更新项目状态文档

---

## 🎯 性能优化

### 前端优化
- [ ] 已启用代码分割
- [ ] 已优化图片大小
- [ ] 已启用浏览器缓存
- [ ] 已压缩CSS和JS文件
- [ ] 已启用CDN加速

### 后端优化
- [ ] 已优化数据库查询
- [ ] 已实施查询缓存
- [ ] 已启用响应压缩
- [ ] 已优化API响应大小
- [ ] 已实施连接池

---

## 🌍 多环境配置

### 开发环境
- [ ] 配置了本地开发环境
- [ ] 设置了开发数据库
- [ ] 配置了开发环境变量

### 预览环境
- [ ] 配置了预览环境（PR自动部署）
- [ ] 设置了预览数据库
- [ ] 配置了预览环境变量

### 生产环境
- [ ] 配置了生产环境
- [ ] 设置了生产数据库
- [ ] 配置了生产环境变量
- [ ] 启用了生产优化

---

## 📞 支持准备

### 用户支持
- [ ] 准备了用户使用手册
- [ ] 设置了问题反馈渠道
- [ ] 准备了常见问题FAQ
- [ ] 设置了技术支持联系方式

### 开发者支持
- [ ] 准备了技术文档
- [ ] 记录了部署流程
- [ ] 记录了故障排除步骤
- [ ] 准备了应急预案

---

## ✨ 最终检查

在宣布部署完成之前：

- [ ] 所有功能都已测试通过
- [ ] 所有性能指标达标
- [ ] 所有安全检查通过
- [ ] 所有监控已设置
- [ ] 所有文档已更新
- [ ] 团队成员已通知
- [ ] 备份恢复已测试

---

## 🎉 部署完成！

恭喜！你已经完成了所有部署步骤。

### 下一步行动
1. 通知团队部署完成
2. 发布更新公告
3. 收集用户反馈
4. 持续监控应用状态
5. 准备下一次迭代

---

**记录部署信息**

- 部署日期：_________________
- 部署人员：_________________
- 前端URL：_________________
- 后端URL：_________________
- 数据库：_________________
- 版本号：_________________
- 备注：_________________

