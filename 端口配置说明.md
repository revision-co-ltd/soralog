# 端口配置说明

## 问题原因

之前的配置存在多个端口问题：
1. ❌ **前端 (Vite)**: 配置为 3000 端口
2. ❌ **后端 (Express)**: 配置为 3000 端口
3. ❌ **API服务配置**: 配置连接到 3002 端口

**端口冲突流程**：
- 后端先启动，占用3000端口 ✓
- 前端Vite尝试使用3000，发现被占用
- Vite自动使用下一个可用端口3001 ⚠️
- 前端API调用尝试连接3002，连接失败 ❌

这导致同时运行两个版本的应用，且API调用失败。

## 已修复的配置

现在使用标准端口分配：

### 前端 (Vite)
- **端口**: 5173 (Vite标准端口)
- **访问地址**: http://localhost:5173
- **配置文件**: `vite.config.ts`

### 后端 (Express API)
- **端口**: 3000
- **访问地址**: http://localhost:3000/api
- **配置文件**: `backend/src/index.ts`

### 数据库 (PostgreSQL)
- **端口**: 5432
- **访问地址**: localhost:5432
- **配置文件**: `docker-compose.yml`

## 如何启动

### 1. 启动数据库
```bash
docker-compose up -d
```

### 2. 启动后端 (端口 3000)
```bash
npm run backend
```
访问 http://localhost:3000/health 验证后端运行正常

### 3. 启动前端 (端口 5173)
```bash
npm run dev
```
浏览器自动打开 http://localhost:5173

## 验证

启动完成后，您应该看到：
- ✅ 前端运行在 http://localhost:5173
- ✅ 后端运行在 http://localhost:3000
- ✅ **不再有** 3001 端口的冲突版本

## 如果还看到3001端口

如果您仍然看到3001端口在运行，可能是旧进程未关闭：

### 查找并关闭旧进程

#### macOS/Linux:
```bash
# 查找占用3001端口的进程
lsof -i :3001

# 关闭进程 (替换PID为上面命令返回的进程ID)
kill -9 <PID>
```

#### Windows:
```cmd
# 查找占用3001端口的进程
netstat -ano | findstr :3001

# 关闭进程 (替换PID为上面命令返回的进程ID)
taskkill /PID <PID> /F
```

### 或者重启所有服务

```bash
# 停止所有Node进程
pkill -f node

# 重新启动
docker-compose up -d
npm run backend  # 在新终端
npm run dev      # 在另一个新终端
```

## 端口对照表

| 服务 | 旧配置 | 新配置 | 说明 |
|------|--------|--------|------|
| 前端 | ~~3000~~ → 3001 (冲突) | ✅ 5173 | Vite标准端口 |
| 后端 | 3000 | ✅ 3000 | Express API |
| 数据库 | 5432 | ✅ 5432 | PostgreSQL |

## 修改的文件

1. ✅ `vite.config.ts` - 前端端口从3000改为5173
2. ✅ `src/services/api.service.ts` - API地址从3002改为3000
3. ✅ `README.md` - 更新端口说明
4. ✅ `端口配置说明.md` (本文档) - 详细配置说明

## 注意事项

- **前端开发**: 始终访问 http://localhost:5173
- **API调用**: 前端会自动调用 http://localhost:3000/api
- **避免混淆**: 3001端口已不再使用，可以忽略

---

**最后更新**: 2025年11月14日

